"use strict";(self.webpackChunkmercury_docs=self.webpackChunkmercury_docs||[]).push([[197],{5082:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>d,toc:()=>a});var s=t(4848),r=t(8453);const i={sidebar_position:1},c="Tutorial - nodejs",d={id:"nodejs-client/manage-docs-versions",title:"Tutorial - nodejs",description:"To use the NodeJS client app, first clone the mercurylayer repository:",source:"@site/docs/nodejs-client/manage-docs-versions.md",sourceDirName:"nodejs-client",slug:"/nodejs-client/manage-docs-versions",permalink:"/docs/nodejs-client/manage-docs-versions",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"NodeJS client",permalink:"/docs/category/nodejs-client"},next:{title:"Client API",permalink:"/docs/nodejs-client/client-api"}},o={},a=[];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"tutorial---nodejs",children:"Tutorial - nodejs"}),"\n",(0,s.jsx)(n.p,{children:"To use the NodeJS client app, first clone the mercurylayer repository:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"git clone https://github.com/commerceblock/mercurylayer.git\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Then switch to the ",(0,s.jsx)(n.code,{children:"dev"})," branch:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"cd mercurylayer\ngit checkout dev\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then change directory to the nodejs client library and link:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"cd clients/libs/nodejs\nnpm link\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then change directory to the standalone client and link the library, and install dependencies:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"cd ../../apps/nodejs\nnpm link mercurynodejslib\nnpm install\n"})}),"\n",(0,s.jsxs)(n.p,{children:["In this directory is the ",(0,s.jsx)(n.code,{children:"config/default.json"})," file for the client. This needs to be edited (using any text editor, e.g. vi or nano) to set the mercury server endpoint and Electrum server URL."]}),"\n",(0,s.jsxs)(n.p,{children:["For the purposes of demonstration, use the following ",(0,s.jsx)(n.code,{children:"Settings.toml"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'{\n    "statechainEntity": "http://test.mercurylayer.com:8500",\n    "electrumServer": "tcp://mutinynet.com:50001",\n    "electrumType": "electrs",\n    "network": "signet",\n    "feeRateTolerance": 5,\n    "databaseFile": "wallet.db",\n    "confirmationTarget": 2,\n    "maxFeeRate": 1\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The test mercury key server URL is: ",(0,s.jsx)(n.code,{children:"http://test.mercurylayer.com:8500"})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Note that this is a test server. It is free to use, but there is no guarantee of persistence or security. Use only for testnet or signet coins."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Once the settings are complete, initialise a wallet using:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"node index.js create-wallet <wallet_name>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Running this with name ",(0,s.jsx)(n.code,{children:"test_wallet"})," should return an object like:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'{\n  "name": "test_wallet",\n  "mnemonic": "chronic ensure limb ripple avocado satisfy doll text lunar among quantum pact",\n  "version": "0.1.0",\n  "state_entity_endpoint": "http://test.mercurylayer.com:8500",\n  "electrum_endpoint": "tcp://mutinynet.com:50001",\n  "network": "signet",\n  "blockheight": 1169081,\n  "initlock": 100000,\n  "interval": 6,\n  "tokens": [],\n  "activities": [],\n  "coins": [],\n  "settings": {\n    "network": "signet",\n    "block_explorerURL": null,\n    "torProxyHost": null,\n    "torProxyPort": null,\n    "torProxyControlPassword": null,\n    "torProxyControlPort": null,\n    "statechainEntityApi": "http://test.mercurylayer.com:8500",\n    "torStatechainEntityApi": null,\n    "electrumProtocol": "tcp",\n    "electrumHost": "mutinynet.com",\n    "electrumPort": "50001",\n    "electrumType": "electrs",\n    "notifications": false,\n    "tutorials": false\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"In order to use the mercury layer key server, an access token is required in order to create a shared key. For the test server, tokens can be generated as follows from the command line:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"node index.js new-token\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Which will return a ",(0,s.jsx)(n.code,{children:"token_id"})," e.g. ",(0,s.jsx)(n.code,{children:"e7d8c299-7121-48b3-bc78-8c70bf4c9691"})]}),"\n",(0,s.jsx)(n.p,{children:"With a valid token recieved by the client, it is then possible to generate a shared key and address to deposit testnet bitcoin into:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"node index.js new-deposit-address <wallet_name> <amount>\n"})}),"\n",(0,s.jsx)(n.p,{children:"For example the following will initialise a coin for an amount of 200000 sats."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"node index.js new-deposit-address test_wallet 200000\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This command will then generate the shared key with the server and display the address along with the ",(0,s.jsx)(n.code,{children:"statechain_id"}),", e.g.:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'{\n  "deposit_address": "tb1p6df39hvwsaaahyg9h9q4w48r3k9vdzqrtcw5shccudnavcs3cduq83ue9p",\n  "statechain_id": "b77944a3deec40809a50db19327dce2d"\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Copy the address and pay the specified amount to it. For the mutinynet signet network, this payment can be made directly via the faucet: ",(0,s.jsx)(n.a,{href:"https://faucet.mutinynet.com/",children:"faucet.mutinynet.com"})]}),"\n",(0,s.jsx)(n.p,{children:"Once paid, run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"node index.js list-statecoins <wallet-name>\n"})}),"\n",(0,s.jsx)(n.p,{children:"To list the coins in the wallet and complete the deposit process."}),"\n",(0,s.jsx)(n.p,{children:"This will return e.g.:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'[\n  {\n    "statechain_id": "b77944a3deec40809a50db19327dce2d",\n    "amount": 100000,\n    "status": "INITIALISED",\n    "adress": "tml1qqpjchvn6ruamvvwq2hmffq6vedvvv7dv8krqg6h3e4wmjyjuzrcslgrepkddgq8yggf0pa6wjcugs4vsruf98p3f067zdc2ych02rp423ls3nhe64"\n  }\n]\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Once the ",(0,s.jsx)(n.code,{children:"status"})," shows ",(0,s.jsx)(n.code,{children:"CONFIRMED"}),", the coin can be transferred."]}),"\n",(0,s.jsx)(n.p,{children:"To generate a statecoin receieve address, run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"node index.js new-transfer-address <wallet_name>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Which will generate a mercury layer address to recieve a coin to. e.g.:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'{\n  "new_transfer_address:": "tml1qqp7m5tc9auxgwka84tez9vksky2lsp5uftyhhduakt75j8yq46wh3crh26fwzxw2akc43d9m0pvuhmuq57tcdtw7pz96zfsz8ck3d3jjf3q04re26"\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["This address can then be used to send a specified coin (with ",(0,s.jsx)(n.code,{children:"statechain_id"}),") coin to a specified statechain address:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"node index.js transfer-send <wallet_name> <statechain-id> <statechain-address>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For example, with the confirmed coin above (",(0,s.jsx)(n.code,{children:'statechain_id: "b77944a3deec40809a50db19327dce2d"'}),")"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"node index.js transfer-send test_wallet tml1qqp7m5tc9auxgwka84tez9vksky2lsp5uftyhhduakt75j8yq46wh3crh26fwzxw2akc43d9m0pvuhmuq57tcdtw7pz96zfsz8ck3d3jjf3q04re26 b77944a3deec40809a50db19327dce2d\n"})}),"\n",(0,s.jsx)(n.p,{children:"This will return:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'{\n  "Transfer": "sent"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"The recevier then runs the following command to finalise the receipt of the coin and update the key share:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"node index.js transfer-receive <wallet_name>\n"})}),"\n",(0,s.jsx)(n.p,{children:"The coin will then appear in the coins list:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"node index.js list-statecoins <wallet-name>\n"})}),"\n",(0,s.jsx)(n.p,{children:"To send the coin back to a standard on-chain bitcoin address, simply run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"node index.js withdraw <wallet_name> <statechain-id> <btc-address> <optional_fee_rate>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For the demo test coins, these can be sent back to an address generated by the faucet: ",(0,s.jsx)(n.a,{href:"https://faucet.mutinynet.com/",children:"faucet.mutinynet.com"})]}),"\n",(0,s.jsx)(n.p,{children:"In case the coin expires and the mercury server is unavailable, the backup transaction can be used as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"node index.js broadcast-backup-transaction <wallet_name> <statechain-id> <btc-address> <optional_fee_rate>\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>d});var s=t(6540);const r={},i=s.createContext(r);function c(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);